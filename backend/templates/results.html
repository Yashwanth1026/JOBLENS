<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobLens AI - Analysis Results</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- GSAP for Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(45deg, #e0f2fe, #fefce8, #e0f2fe);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #1e293b;
            transition: background 0.5s ease, color 0.5s ease;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .header {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: background 0.5s ease;
        }
        .section-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.5s ease, color 0.5s ease;
        }
        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .score-circle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: conic-gradient(#10B981 0% var(--score-angle, 0%), #e5e7eb 0% 100%);
            z-index: 1;
        }
        .score-circle::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            background: white;
            border-radius: 50%;
            z-index: 2;
        }
        .score-circle span {
            position: relative;
            z-index: 3;
            color: #1e293b;
        }
        .score-high { background-color: #10B981; }
        .score-medium { background-color: #FBBF24; }
        .score-low { background-color: #EF4444; }
        .section-title {
            color: #3b82f6;
            font-weight: 700;
            border-bottom: 3px solid #8b5cf6;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            transition: color 0.5s ease, border-color 0.5s ease;
        }
        .list-disc li {
            margin-bottom: 0.5rem;
        }
        .progress {
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            transition: background 0.5s ease;
        }
        .progress-bar {
            background: #8b5cf6;
            transition: width 1s ease, background 0.5s ease;
        }
        .btn-back {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-weight: 500;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.5s ease;
        }
        .btn-back:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            color: white;
        }
        footer {
            background: #1e293b;
            color: #e5e7eb;
            padding: 1rem 0;
            text-align: center;
            transition: background 0.5s ease, color 0.5s ease;
        }
        .note-text {
            font-style: italic;
            color: #6b7280;
        }
        /* Dark Mode */
        .dark-mode {
            background: linear-gradient(45deg, #1e293b, #2d3748, #1e293b);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
            color: #e5e7eb;
        }
        .dark-mode .header {
            background: linear-gradient(45deg, #2d3748, #4b5563);
        }
        .dark-mode .section-card {
            background: rgba(45, 55, 72, 0.9);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        .dark-mode .section-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        .dark-mode .section-title {
            color: #a5b4fc;
            border-bottom: 3px solid #8B5CF6;
        }
        .dark-mode .score-circle::before {
            background: conic-gradient(#10B981 0% var(--score-angle, 0%), #4b5563 0% 100%);
        }
        .dark-mode .score-circle::after {
            background: #2d3748;
        }
        .dark-mode .score-circle span {
            color: #e5e7eb;
        }
        .dark-mode .progress {
            background: #4b5563;
        }
        .dark-mode .progress-bar {
            background: #8B5CF6;
        }
        .dark-mode .btn-back {
            background: linear-gradient(45deg, #8B5CF6, #a5b4fc);
        }
        .dark-mode .btn-back:hover {
            background: linear-gradient(45deg, #7c3aed, #93c5fd);
        }
        .dark-mode .note-text {
            color: #9ca3af;
        }
        .dark-mode .text-primary {
            color: #a5b4fc !important;
        }
        .dark-mode .text-secondary {
            color: #9ca3af !important;
        }
        .dark-mode .text-muted {
            color: #d1d5db !important;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
        }
        ::-webkit-scrollbar-thumb {
            background: #4B5EAA;
            border-radius: 4px;
        }
        .dark-mode ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        .dark-mode ::-webkit-scrollbar-thumb {
            background: #8B5CF6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <h1 class="display-5 fw-bold animate__animated animate__zoomIn">Your JobLens AI Results</h1>
                <p class="lead mt-2 animate__animated animate__fadeInUp animate__delay-1s">
                    Here's a detailed analysis of your resume to help you shine!
                </p>
            </div>
            <button id="themeToggle" class="btn btn-link text-white">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container py-5">
        <!-- Error Message -->
        <div id="errorMessage" class="alert alert-danger d-none" role="alert">
            <p id="errorText"></p>
        </div>

        <!-- ATS Compatibility -->
        <section id="atsSection" class="section-card d-none animate__animated animate__fadeInUp">
            <h2 class="section-title">ATS Compatibility</h2>
            <div class="d-flex align-items-center mb-4">
                <div id="scoreCircle" class="score-circle me-4"></div>
                <div>
                    <p class="fw-medium">ATS Score</p>
                    <p id="scoreText" class="display-6 fw-bold text-primary"></p>
                </div>
            </div>
            <p class="note-text mb-3">Note: A higher ATS score indicates better compatibility and more accurate extraction of details from your resume.</p>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <h5 class="fw-medium text-secondary">File Format</h5>
                    <p id="fileFormat" class="text-muted"></p>
                    <p id="fileIssues" class="text-danger mt-1"></p>
                </div>
                <div class="col-md-6 mb-3">
                    <h5 class="fw-medium text-secondary">Warnings</h5>
                    <ul id="warningsList" class="list-disc text-muted ps-4"></ul>
                </div>
            </div>
            <div class="mb-3">
                <h5 class="fw-medium text-secondary">Recommendations</h5>
                <ul id="recommendationsList" class="list-disc text-muted ps-4"></ul>
            </div>
            <div id="detailsSection">
                <h5 class="fw-medium text-secondary">Detailed Analysis</h5>
                <div id="detailsContent" class="text-muted space-y-2"></div>
            </div>
        </section>

        <!-- Resume Details -->
        <section id="resumeSection" class="section-card d-none animate__animated animate__fadeInUp animate__delay-1s">
            <h2 class="section-title">Resume Details</h2>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <p class="fw-medium text-secondary">Name</p>
                    <p id="resumeName" class="text-muted"></p>
                </div>
                <div class="col-md-6 mb-3">
                    <p class="fw-medium text-secondary">Email</p>
                    <p id="resumeEmail" class="text-muted"></p>
                </div>
                <div class="col-md-6 mb-3">
                    <p class="fw-medium text-secondary">Phone</p>
                    <p id="resumePhone" class="text-muted"></p>
                </div>
                <div class="col-md-6 mb-3">
                    <p class="fw-medium text-secondary">Skills</p>
                    <p id="resumeSkills" class="text-muted"></p>
                </div>
            </div>
            <div class="mb-3">
                <p class="fw-medium text-secondary">Education</p>
                <ul id="resumeEducation" class="list-disc text-muted ps-4"></ul>
            </div>
            <div>
                <p class="fw-medium text-secondary">Experience</p>
                <div id="resumeExperience" class="text-muted space-y-3"></div>
            </div>
        </section>

        <!-- Job Predictions -->
        <section id="predictionsSection" class="section-card d-none animate__animated animate__fadeInUp animate__delay-2s">
            <h2 class="section-title">Job Predictions</h2>
            <div class="row">
                <div class="col-md-6 mb-4">
                    <p class="fw-medium text-secondary">Predicted Job Category</p>
                    <p id="categoryPrediction" class="text-primary fw-bold fs-5"></p>
                    <div id="categoryProbs" class="mt-2"></div>
                </div>
                <div class="col-md-6 mb-4">
                    <p class="fw-medium text-secondary">Predicted Job Role</p>
                    <p id="jobPrediction" class="text-primary fw-bold fs-5"></p>
                    <div id="jobProbs" class="mt-2"></div>
                </div>
            </div>
        </section>

        <!-- Navigation Button -->
        <div class="text-center mt-5">
            <a href="/" class="btn btn-back animate__animated animate__bounceIn">
                <i class="fas fa-home me-2"></i> Back to Home
            </a>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>© 2025 JobLens AI. All rights reserved.</p>
        </div>
    </footer>

    <script>
        function displayResults() {
            const atsResult = JSON.parse(sessionStorage.getItem('atsResult'));
            const predictResult = JSON.parse(sessionStorage.getItem('predictResult'));
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');

            if (!atsResult || !predictResult) {
                errorText.textContent = 'No analysis results found. Please upload a resume and try again.';
                errorMessage.classList.remove('d-none');
                return;
            }

            if (atsResult.error || predictResult.error) {
                errorText.textContent = atsResult.error || predictResult.error || 'An error occurred during analysis. Please try again.';
                errorMessage.classList.remove('d-none');
                return;
            }

            // ATS Compatibility Section
            const atsSection = document.getElementById('atsSection');
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreText = document.getElementById('scoreText');
            const fileFormat = document.getElementById('fileFormat');
            const fileIssues = document.getElementById('fileIssues');
            const warningsList = document.getElementById('warningsList');
            const recommendationsList = document.getElementById('recommendationsList');
            const detailsContent = document.getElementById('detailsContent');

            atsSection.classList.remove('d-none');
            const score = atsResult.score || 0;
            const scoreAngle = (score / 100) * 360; // Convert percentage to degrees for conic-gradient
            scoreCircle.style.setProperty('--score-angle', `${scoreAngle}deg`);
            scoreCircle.innerHTML = `<span>${score}%</span>`;
            scoreCircle.classList.add(score >= 80 ? 'score-high' : score >= 60 ? 'score-medium' : 'score-low');
            scoreText.textContent = `${score}%`;

            // Animate score circle and text
            gsap.from(scoreCircle, { scale: 0, duration: 1, ease: 'elastic.out(1, 0.5)' });
            gsap.from(scoreText, { opacity: 0, y: 20, duration: 1, delay: 0.5, ease: 'power2.out' });

            fileFormat.textContent = `Format: ${atsResult.file_format.format || 'Unknown'}, Size: ${(atsResult.file_format.size_mb || 0).toFixed(2)} MB`;
            fileIssues.textContent = atsResult.file_format.issues?.length ? `Issues: ${atsResult.file_format.issues.join(', ')}` : 'No issues detected';

            warningsList.innerHTML = atsResult.warnings?.length ? atsResult.warnings.map(w => `<li>${w}</li>`).join('') : '<li>No warnings</li>';
            recommendationsList.innerHTML = atsResult.recommendations?.length ? atsResult.recommendations.map(r => `<li>${r}</li>`).join('') : '<li>No recommendations</li>';

            // Detailed Analysis
            if (atsResult.details) {
                let detailsHtml = '';
                if (atsResult.details.structure) {
                    let structureDetails = `<p><strong>Structure:</strong> `;
                    if (atsResult.details.structure.found_sections?.length) {
                        structureDetails += `Found: ${atsResult.details.structure.found_sections.join(', ')}`;
                    }
                    if (atsResult.details.structure.missing_sections?.length) {
                        structureDetails += `${atsResult.details.structure.found_sections?.length ? '; ' : ''}Missing: ${atsResult.details.structure.missing_sections.join(', ')}`;
                    }
                    if (atsResult.details.structure.section_order?.length) {
                        structureDetails += `${(atsResult.details.structure.found_sections?.length || atsResult.details.structure.missing_sections?.length) ? '; ' : ''}Order: ${atsResult.details.structure.section_order.join(' → ')}`;
                    }
                    detailsHtml += structureDetails + '</p>';
                }
                if (atsResult.details.content) {
                    let contentDetails = `<p><strong>Content:</strong> Word Count: ${atsResult.details.content.word_count || 'N/A'}`;
                    if (atsResult.details.content.skills?.length) {
                        contentDetails += `; Skills: ${atsResult.details.content.skills.slice(0, 5).join(', ')}${atsResult.details.content.skills.length > 5 ? '...' : ''}`;
                    }
                    detailsHtml += contentDetails + '</p>';
                }
                if (atsResult.details.keywords?.job_description_similarity) {
                    detailsHtml += `<p><strong>Keywords:</strong> Job Description Similarity: ${atsResult.details.keywords.job_description_similarity}%</p>`;
                }
                if (atsResult.details.industry_benchmark) {
                    let benchmarkDetails = `<p><strong>Industry Benchmark:</strong> Industry: ${atsResult.details.industry_benchmark.industry || 'Unknown'}; Relevance: ${(atsResult.details.industry_benchmark.industry_relevance * 100 || 0).toFixed(2)}%`;
                    if (atsResult.details.industry_benchmark.missing_keywords?.length) {
                        benchmarkDetails += `; Missing Keywords: ${atsResult.details.industry_benchmark.missing_keywords.slice(0, 3).join(', ')}${atsResult.details.industry_benchmark.missing_keywords.length > 3 ? '...' : ''}`;
                    }
                    detailsHtml += benchmarkDetails + '</p>';
                }
                detailsContent.innerHTML = detailsHtml || '<p>No detailed analysis available.</p>';
            } else {
                detailsContent.innerHTML = '<p>No detailed analysis available.</p>';
            }

            // Resume Details Section
            const resumeSection = document.getElementById('resumeSection');
            const resumeName = document.getElementById('resumeName');
            const resumeEmail = document.getElementById('resumeEmail');
            const resumePhone = document.getElementById('resumePhone');
            const resumeSkills = document.getElementById('resumeSkills');
            const resumeEducation = document.getElementById('resumeEducation');
            const resumeExperience = document.getElementById('resumeExperience');

            resumeSection.classList.remove('d-none');
            const resumeData = predictResult['Resume Data'] || {};
            resumeName.textContent = resumeData.Name || 'Not Found';
            resumeEmail.textContent = resumeData.Email || 'Not Found';
            resumePhone.textContent = resumeData.Phone || 'Not Found';
            resumeSkills.textContent = resumeData.Skills || 'Not Found';

            // Education Extraction
            if (Array.isArray(resumeData.Education) && resumeData.Education.length && resumeData.Education.every(item => item !== 'Not Found')) {
                resumeEducation.innerHTML = resumeData.Education.map(e => `<li>${e}</li>`).join('');
            } else {
                resumeEducation.innerHTML = '<li>Not Found</li>';
            }

            if (Array.isArray(resumeData.Experience) && resumeData.Experience.length && resumeData.Experience.every(item => item !== 'Not Found')) {
                resumeExperience.innerHTML = resumeData.Experience.map(exp => {
                    if (typeof exp === 'object' && exp !== null) {
                        return `
                            <div class="border-l-4 border-primary pl-4">
                                <p class="fw-semibold">${exp['Job Title'] || 'Untitled'} at ${exp.Company || 'Unknown'}</p>
                                <p class="text-sm text-muted">${exp.Duration || ''} ${exp.Location ? ' | ' + exp.Location : ''}</p>
                                <ul class="list-disc pl-5 mt-1">
                                    ${Array.isArray(exp['Key Responsibilities']) 
                                        ? exp['Key Responsibilities'].map(r => `<li>${r}</li>`).join('')
                                        : '<li>No responsibilities listed</li>'}
                                </ul>
                            </div>
                        `;
                    }
                    return `<div>${exp}</div>`;
                }).join('');
            } else {
                resumeExperience.textContent = 'Not Found';
            }

            // Job Predictions Section
            const predictionsSection = document.getElementById('predictionsSection');
            const categoryPrediction = document.getElementById('categoryPrediction');
            const jobPrediction = document.getElementById('jobPrediction');
            const categoryProbs = document.getElementById('categoryProbs');
            const jobProbs = document.getElementById('jobProbs');

            predictionsSection.classList.remove('d-none');
            const predictions = predictResult.Predictions || {};
            categoryPrediction.textContent = predictions.Categorization || 'Unknown';
            jobPrediction.textContent = predictions['Job Recommendation'] || 'Unknown';

            if (predictions['Category Probabilities']) {
                categoryProbs.innerHTML = '<p class="text-sm fw-medium text-secondary mt-2">Confidence Scores:</p>' + 
                    Object.entries(predictions['Category Probabilities'])
                        .sort(([, a], [, b]) => b - a)
                        .slice(0, 5)
                        .map(([cat, prob], index) => `
                            <div class="mb-2">
                                <small>${cat}: ${prob}%</small>
                                <div class="progress">
                                    <div class="progress-bar" style="width: 0%" data-width="${prob}"></div>
                                </div>
                            </div>
                        `).join('');
                // Animate progress bars
                document.querySelectorAll('#categoryProbs .progress-bar').forEach((bar, index) => {
                    gsap.to(bar, {
                        width: bar.getAttribute('data-width') + '%',
                        duration: 1,
                        delay: index * 0.2,
                        ease: 'power2.out'
                    });
                });
            } else {
                categoryProbs.innerHTML = '<p class="text-sm text-muted">No probability data available.</p>';
            }

            if (predictions['Job Recommendation Probabilities']) {
                jobProbs.innerHTML = '<p class="text-sm fw-medium text-secondary mt-2">Confidence Scores:</p>' + 
                    Object.entries(predictions['Job Recommendation Probabilities'])
                        .sort(([, a], [, b]) => b - a)
                        .slice(0, 5)
                        .map(([job, prob], index) => `
                            <div class="mb-2">
                                <small>${job}: ${prob}%</small>
                                <div class="progress">
                                    <div class="progress-bar" style="width: 0%" data-width="${prob}"></div>
                                </div>
                            </div>
                        `).join('');
                // Animate progress bars
                document.querySelectorAll('#jobProbs .progress-bar').forEach((bar, index) => {
                    gsap.to(bar, {
                        width: bar.getAttribute('data-width') + '%',
                        duration: 1,
                        delay: index * 0.2,
                        ease: 'power2.out'
                    });
                });
            } else {
                jobProbs.innerHTML = '<p class="text-sm text-muted">No probability data available.</p>';
            }
        }

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = themeToggle.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            }
        });

        // Load theme from localStorage
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeToggle.querySelector('i').classList.replace('fa-moon', 'fa-sun');
        }

        // Run display on page load
        window.onload = displayResults;
    </script>
</body>
</html>
